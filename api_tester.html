<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± API - Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #8B3C45;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .token-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-right: 4px solid #8B3C45;
        }

        .token-input {
            width: 400px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: monospace;
            direction: ltr;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .api-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .api-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
        }

        .api-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .api-title h3 {
            color: #333;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .method {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .method.get { background: #61affe; }
        .method.post { background: #49cc90; }
        .method.put { background: #fca130; }
        .method.delete { background: #f93e3e; }

        .endpoint {
            background: #f5f5f5;
            padding: 10px 15px;
            border-radius: 8px;
            font-family: monospace;
            direction: ltr;
            font-size: 13px;
            margin-bottom: 15px;
            color: #666;
        }

        .request-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-size: 13px;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: #8B3C45;
            outline: none;
            box-shadow: 0 0 0 3px rgba(139,60,69,0.1);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #8B3C45;
            color: white;
        }

        .btn-primary:hover {
            background: #6e3137;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .response-area {
            background: #1e1e2d;
            color: #fff;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            direction: ltr;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 8px 15px;
            background: #e9ecef;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-btn:hover {
            background: #dee2e6;
        }

        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .token-input { width: 100%; }
            .header { flex-direction: column; gap: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
        <div class="header">
            <h1>
                <span>ğŸ› ï¸</span>
                Ø§Ø®ØªØ¨Ø§Ø± API - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
            </h1>
            <div class="token-section">
                <div style="margin-bottom: 10px; font-weight: 500;">ğŸ” ØªÙˆÙƒÙ† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:</div>
                <input type="text" id="authToken" class="token-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ù‡Ù†Ø§..." value="">
                <button class="quick-btn" onclick="loginTest()" style="margin-right: 10px;">
                    ğŸš€ ØªØ¬Ø±Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </div>
        </div>

        <!-- Ø´Ø¨ÙƒØ© API -->
        <div class="grid">
            <!-- Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© -->
            <div class="api-card">
                <div class="api-title">
                    <h3>ğŸ”‘ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</h3>
                    <span class="method post">POST</span>
                </div>
                <div class="endpoint">/login</div>
                <div class="request-form">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <input type="text" id="login_username" class="form-control" placeholder="admin" value="admin">
                    </div>
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="login_password" class="form-control" placeholder="******" value="admin">
                    </div>
                    <button class="btn btn-primary" onclick="testLogin()">
                        <span>ğŸ”“</span> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                </div>
            </div>

            <!-- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
            <div class="api-card">
                <div class="api-title">
                    <h3>ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                    <div>
                        <span class="method get" style="margin-left: 5px;">GET</span>
                        <span class="method post">POST</span>
                    </div>
                </div>
                <div class="endpoint">/users</div>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="testGetUsers()">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
                    <button class="quick-btn" onclick="testCreateUser()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
                </div>
                <div style="margin-top: 15px;">
                    <textarea id="userData" class="form-control" rows="3" placeholder="Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (JSON)">{
    "username": "test_user",
    "password": "password123",
    "role_id": 4
}</textarea>
                </div>
                <button class="btn btn-success" style="margin-top: 10px;" onclick="testCreateUser()">
                    Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                </button>
            </div>

            <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª -->
            <div class="api-card">
                <div class="api-title">
                    <h3>ğŸ’³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h3>
                    <div>
                        <span class="method get">GET</span>
                        <span class="method post">POST</span>
                        <span class="method put">PUT</span>
                    </div>
                </div>
                <div class="endpoint">/cards</div>
                <div class="quick-actions">
                    <button class="quick-btn" onclick="testGetCards()">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</button>
                    <button class="quick-btn" onclick="testCreateCard()">â• Ø¥ØµØ¯Ø§Ø± Ø¨Ø·Ø§Ù‚Ø©</button>
                </div>
                <div style="margin-top: 15px;">
                    <input type="text" id="cardSearch" class="form-control" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
                    <button class="quick-btn" style="margin-top: 5px;" onclick="testGetCard()">Ø¨Ø­Ø«</button>
                </div>
            </div>

            <!-- Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
            <div class="api-card">
                <div class="api-title">
                    <h3>ğŸ­ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h3>
                    <span class="method get">GET</span>
                </div>
                <div class="endpoint">/roles</div>
                <button class="btn btn-primary" onclick="testGetRoles()" style="margin-top: 10px;">
                    ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                </button>
            </div>

            <!-- Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª -->
            <div class="api-card">
                <div class="api-title">
                    <h3>ğŸ“Š Ø§Ù„Ø­Ø§Ù„Ø§Øª</h3>
                    <span class="method get">GET</span>
                </div>
                <div class="endpoint">/statuses</div>
                <button class="btn btn-primary" onclick="testGetStatuses()" style="margin-top: 10px;">
                    ğŸ“‹ Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
                </button>
            </div>

            <!-- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
            <div class="api-card">
                <div class="api-title">
                    <h3>âœ… Ø§Ù„ØªØ­Ù‚Ù‚</h3>
                    <span class="method get">GET</span>
                </div>
                <div class="endpoint">/verify?token=</div>
                <div class="form-group">
                    <label>Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</label>
                    <input type="text" id="verifyToken" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚">
                </div>
                <button class="btn btn-primary" onclick="testVerifyCard()" style="margin-top: 10px;">
                    ğŸ” ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
                </button>
            </div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div style="background: white; border-radius: 15px; padding: 25px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="color: #333;">ğŸ“ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
                <div>
                    <span id="responseStatus" class="status-badge" style="display: none;">200 OK</span>
                </div>
            </div>
            <div id="responseArea" class="response-area">
                // Ø§Ù†ØªØ¸Ø± ØªÙ†ÙÙŠØ° Ø·Ù„Ø¨...
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost/driver_cards'; // ØºÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· Ø­Ø³Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ

        // ==================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ====================
        function getToken() {
            return document.getElementById('authToken').value??"274dc52a82ee448ed72adac0d2d6bf84896d3b072ac7b49abbbc94439231184b";
        }

        async function apiRequest(endpoint, method, data = null, auth = true) {
            const url = `${BASE_URL}/index.php?path=${endpoint}`;
            const headers = {
                'Content-Type': 'application/json'
            };

            if (auth) {
                const token = getToken();
                if (token) {
                    headers['Authorization'] = 'Bearer ' + token;
                }
            }

            const options = {
                method,
                headers,
                body: data ? JSON.stringify(data) : null
            };

            try {
                const response = await fetch(url, options);
                const responseData = await response.json();
                
                displayResponse({
                    status: response.status,
                    statusText: response.statusText,
                    data: responseData,
                    headers: response.headers
                });

                return { status: response.status, data: responseData };
            } catch (error) {
                displayResponse({
                    status: 500,
                    statusText: 'Network Error',
                    error: error.message
                });
                return { status: 500, error: error.message };
            }
        }

        function displayResponse(response) {
            const area = document.getElementById('responseArea');
            const statusBadge = document.getElementById('responseStatus');
            
            let html = '';
            
            // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© HTTP
            if (response.status) {
                const statusClass = response.status >= 200 && response.status < 300 ? 'status-success' : 'status-error';
                statusBadge.style.display = 'inline-block';
                statusBadge.className = `status-badge ${statusClass}`;
                statusBadge.textContent = `${response.status} ${response.statusText}`;
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (response.error) {
                html += `âŒ Ø®Ø·Ø£: ${response.error}\n\n`;
            }

            if (response.data) {
                html += JSON.stringify(response.data, null, 2);
            }

            area.textContent = html || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª';
        }

        // ==================== Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª API ====================

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function testLogin() {
            const username = document.getElementById('login_username').value;
            const password = document.getElementById('login_password').value;

            const result = await apiRequest('login', 'POST', {
                username,
                password
            }, false);

            if (result.status === 200 && result.data.token) {
                document.getElementById('authToken').value = result.data.token;
            }
        }

        // ØªØ¬Ø±Ø¨Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
        function loginTest() {
            document.getElementById('login_username').value = 'admin';
            document.getElementById('login_password').value = 'admin';
            testLogin();
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        async function testGetUsers() {
            await apiRequest('users', 'GET');
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù…
        async function testCreateUser() {
            try {
                const userData = JSON.parse(document.getElementById('userData').value);
                await apiRequest('users', 'POST', userData);
            } catch (e) {
                alert('Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ JSON');
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        async function testGetCards() {
            await apiRequest('cards', 'GET');
        }

        // Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø­Ø¯Ø¯Ø©
        async function testGetCard() {
            const cardNumber = document.getElementById('cardSearch').value;
            if (!cardNumber) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©');
                return;
            }
            await apiRequest(`cards&card_number=${cardNumber}`, 'GET');
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©
        async function testCreateCard() {
            const sampleCard = {
                driver_name_ar: "Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ",
                driver_name_en: "Mohammed Ahmed Alali",
                driver_id: "1234567890",
                company_name_ar: "Ø´Ø±ÙƒØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹",
                company_name_en: "Fast Transport Company",
                issue_date: "2025-01-01",
                expiry_date: "2026-01-01",
                card_category_ar: "Ø®Ø§ØµØ©",
                card_category_en: "Private",
                license_number: "11/00052782",
                license_city_ar: "Ø§Ù„Ø±ÙŠØ§Ø¶",
                license_city_en: "Riyadh",
                license_issue_date: "2025-01-01",
                license_expiry_date: "2026-01-01",
                activity_type_ar: "Ù†Ù‚Ù„ Ø®ÙÙŠÙ",
                activity_type_en: "Light Transport",
                moi_number: "9876543210"
            };

            await apiRequest('cards', 'POST', sampleCard);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
        async function testGetRoles() {
            await apiRequest('roles', 'GET');
        }

        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        async function testGetStatuses() {
            await apiRequest('statuses', 'GET');
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
        async function testVerifyCard() {
            const token = document.getElementById('verifyToken').value;
            if (!token) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚');
                return;
            }
            await apiRequest(`verify&token=${token}`, 'GET', null, false);
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† sessionStorage
            const savedToken = sessionStorage.getItem('authToken');
            if (savedToken) {
                document.getElementById('authToken').value = savedToken;
            }
        };
    </script>
</body>
</html>