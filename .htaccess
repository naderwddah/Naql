# تمكين إعادة التوجيه
RewriteEngine On
RewriteBase /driver_cards/

RewriteCond %{HTTP:Authorization} ^(.*)
RewriteRule .* - [e=HTTP_AUTHORIZATION:%1]

# منع عرض الملفات المخفية
RedirectMatch 403 /\..*$

# منع الوصول المباشر للمجلدات الحساسة
RedirectMatch 403 ^/(config|controllers|helpers|logs|models)/?$

# منع الوصول للملفات الحساسة مباشرة
<FilesMatch "\.(ini|error|log|sql)$">
    Require all denied
</FilesMatch>

# استثناء api_tester.html من إعادة التوجيه
#RewriteRule ^api_tester\.html$ - [L]

#  منع إظهار .php في الرابط (إعادة توجيه 301)
RewriteCond %{THE_REQUEST} \s/+(.+)\.php[\s?]
RewriteRule ^ %1 [R=301,L]

#  إذا الملف أو المجلد غير موجود
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

#  مسارات v1
RewriteRule ^v1/?(.*)$ index.php?path=$1 [QSA,L]

#  أي مسار آخر
#RewriteRule ^(.*)$ index.php?path=$1 [QSA,L]


# تعيين الترميز الافتراضي
AddDefaultCharset UTF-8

# حماية headers
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "DENY"
Header set X-XSS-Protection "1; mode=block"

# ===== CORS =====
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization"

# معالجة طلبات OPTIONS (Preflight) لجميع المسارات
#<If "%{REQUEST_METHOD} == 'OPTIONS'">
#    Header always set Access-Control-Max-Age "86400"
#    Require all granted
#    RewriteEngine Off
#    RewriteRule ^ - [R=200,L]
#</If>
